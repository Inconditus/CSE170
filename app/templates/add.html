<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Group buy</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.min.css')}}">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="{{url_for('static', filename='css/add.css')}}">
</head>
<body>
	<div class="stickyheader">
		<div class="logo-background"></div>
		<div class="logo">GroupBuy</div>
		<ul class="categories">
			<li><a href="/items/">Listings</a></li>
			<!-- <li class="active"><a href="#">Add</a></li> -->
			<li><a href="/profile/">My Profile</a></li>
			<!-- <li><a href="manage.html">Manage</a></li> -->
		</ul>
	</div>
	<div class="content">
		<div class="fileUpload input-group">
			<input id="imgup" type="text" class="form-control" placeholder="Image Link">
    		<!-- <span>Select a photo</span>
    		<input id="imgup" type="file" class="upload"/> -->
		</div>
		<!-- <button type="button" class="btn btn-default navbar-btn">Sign in</button> -->
		<div class="input-group input-group-lg select">
		  <input id="name" type="text" class="form-control" placeholder="Item Name">
		</div>
		<div class="input-group input-group-lg select">
		  <input id="desc" type="text" class="form-control" placeholder="Short description">
		</div>
		<div class="input-group input-group-lg select">
		  <input id="origprice" type="text" class="price form-control" placeholder="Original Price">
		  <input id="price" type="text" class="price form-control" placeholder="Bulk Price">
		</div>
		<div class="input-group">
			<span class="input-group-addon">
        		<input id="check" type="checkbox">
      		</span>
			<input id="minnum" type="text" class="form-control" placeholder="Min # of Buyers">
      </div><!-- /btn-group -->
		<div class="input-group input-group-lg select">
		  <a class="myButton">Submit my listing!</a>
		</div>
	</div>
		<script src="http://code.jquery.com/jquery.js"></script>
		<script src="http://code.jquery.com/color/jquery.color-2.1.2.min.js"></script>
		<script src="{{url_for('static', filename='js/jquery.cookies.js')}}"></script>
		<script src-"{{url_for('static', filename='js/bootstrap.js')}}"></script>
		<script type="text/javascript">

			// $('#checked').click(function () {
   //  			$("#txtAge").toggle(this.checked);
			// });
			$(".myButton").click(submit);

			function submit() {
				//console.log($('#check').prop('checked'));

				var imgsrc = $("#imgup").val();
				// placeholder for now
				imgsrc = "http://allaboutuarts.ca/wp-content/uploads/2012/07/placeholder.jpg";
				var name = $("#name").val();
				var desc = $("#desc").val();
				var origprice = $("#origprice").val();
				var price = $("#price").val();
				var check = $('#check').prop('checked');
				if (check === true)
					var minnum = $('#minnum').val();
				else
					var minnum = 0;

				var unfilled = 0;

				// Check for invalid input
				$(".content").find(':input[type=text]').each(function(i) {
					//console.log($(this).val());
					if( $(this).val() === "")
						unfilled++;
				});

				if( check === false )
					unfilled--;

				//console.log(unfilled);

				if (unfilled > 0)
				{
					alert("You have not filled in all the required fields. Please go back and make sure all fields are filled!");
				} else
				{
					if( (check === true) && (minnum == 0))
					{
						alert("Please enter a number > 0 for the minimum # of buyers.");
					}
					else

					if( (origprice < 0) || (price < 0 ) || (minnum < 0) )
					{
						alert("You cannot have negative numbers as prices or buyers!");
					}
					else

					if( isNaN(origprice) || isNaN(price) || isNaN(minnum) )
					{
						alert("Please enter only numbers for the prices and minimum amount of buyers.");
					}
					else
					{

						var JSONinfo = {}

						JSONinfo["check"] = check;
						JSONinfo["name"] = name;
						JSONinfo["desc"] = desc;
						JSONinfo["origprice"] = origprice;
						JSONinfo["price"] = price;
						JSONinfo["imgsrc"] = imgsrc;
						JSONinfo["minnum"] = minnum;
						JSONinfo["seller"] = "Edward T. Hung";

						var date = new Date();
						date.setTime(date.getTime() + (5 * 60 * 1000));

						$.cookie("newitem", JSON.stringify(JSONinfo), { expires: date } );

						window.location.href = "/items/";
					}

				}
				//alert( $.cookie("listinginfo") );
				//console.log(JSON.stringify(JSONinfo));
			}
			
		</script>
	</body>
	</html>